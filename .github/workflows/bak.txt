# å·¥ä½œæµåç§°ï¼Œä¸è®¾ç½®çš„è¯é»˜è®¤å–é…ç½®æ–‡ä»¶å
name: Build and Deploy
# æŒ‡å®šè§¦å‘ workflow çš„æ¡ä»¶
# æŒ‡å®šè§¦å‘äº‹ä»¶æ—¶ï¼Œå¯ä»¥é™å®šåˆ†æ”¯æˆ–æ ‡ç­¾
# å½“å‰æ˜¯ åªæœ‰ masteråˆ†æ”¯ä¸Šè§¦å‘ push äº‹ä»¶æ—¶æ‰æ‰§è¡Œå·¥ä½œæµä»»åŠ¡
on: 
  push:
    branches:
      - master
# å·¥ä½œæµæ‰§è¡Œçš„ä¸€ä¸ªæˆ–å¤šä¸ªä»»åŠ¡
jobs:
  # ä»»åŠ¡åç§°
  build-and-deploy:
    # ä»»åŠ¡è¿è¡Œçš„å®¹å™¨ç±»å‹ï¼ˆè™šæ‹Ÿæœºç¯å¢ƒï¼‰
    runs-on: ubuntu-latest
    # ä»»åŠ¡æ‰§è¡Œçš„æ­¥éª¤
    steps:
      # æ­¥éª¤åç§°
      - name: Checkout ğŸ›ï¸
        # ä½¿ç”¨çš„æ“ä½œ actionsï¼Œå¯ä»¥ä½¿ç”¨å…¬å…±ä»“åº“ï¼Œæœ¬åœ°ä»“åº“ï¼Œåˆ«äººçš„ä»“åº“çš„action
        # æ‹‰å–ä»£ç 
        uses: actions/checkout@v2.3.1
        with:
          persist-credentials: false #checkoutä¾èµ–å‚æ•°ï¼šä¸ä¿å­˜è¯ä¹¦
      - name: Build and Deploy
        # æ„å»ºå‘å¸ƒ Github pages
        uses: JamesIves/github-pages-deploy-action@3.5.9
        # è¯¥æ­¥éª¤æ‰€éœ€çš„ç¯å¢ƒå˜é‡
        env:
          ACCESS_TOKEN: ${{ secrets.TESTVUECICD }}
          # åœ¨éƒ¨ç½²å‰è¦checkoutçš„åŸºæœ¬åˆ†æ”¯ï¼Œé»˜è®¤æ˜¯master
          BASE_BRANCH: master # The branch the action should deploy from.
          # æŒ‡å®šéƒ¨ç½²çš„åˆ†æ”¯ï¼Œé»˜è®¤æ˜¯ gh-pages åˆ†æ”¯
          BRANCH: master # The branch the action should deploy to.
          # å­˜å‚¨åº“ä¸­è¦éƒ¨ç½²çš„æ–‡ä»¶å¤¹ã€‚
          # è¯¥æ­¥éª¤ä¼šå°†é¡¹ç›®ä¸­ FOLDER æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶æ¨é€åˆ° BRANCH åˆ†æ”¯ï¼Œä½œä¸ºGithub Pages éƒ¨ç½²çš„å†…å®¹ã€‚
          # Vue CLIé»˜è®¤æ‰“åŒ…åˆ° dist ç›®å½•
          # ç¯å¢ƒå˜é‡ACTIONS_ALLOW_UNSECURE_COMMANDSè®¾ç½®ä¸ºtrueæ¥é€‰æ‹©ä¸å®‰å…¨çš„å‘½ä»¤æ‰§è¡Œ
          # ACTIONS_ALLOW_UNSECURE_COMMANDS: true
          FOLDER: dist # The folder the action should deploy.
          # åœ¨å‘ BRANCH åˆ†æ”¯æ¨é€ä»£ç å‰ï¼Œå¯ä»¥æŒ‡å®šæ„å»ºè„šæœ¬
          BUILD_SCRIPT: npm install && npm run build:prod # The build script the action should run prior to deploying.



#name: "github actions build and deploy gh-pages" #æµç¨‹åç§°
#on: [push] #å½“å¯¹å½“å‰ä»“åº“pushä»£ç çš„æ—¶å€™è§¦å‘
#jobs: 
#  build-and-deploy: #è„šæœ¬åç§°
#    runs-on: ubuntu-latest #è¿è¡Œåœ¨ä¹Œç­å›¾linuxä¸Š
#    steps:
#     - name: Checkout  #æ­¥éª¤1ï¼šcheckout
#        uses: actions/checkout@v2.3.1 #checkoutéœ€è¦å¼•ç”¨çš„ä¾èµ–
#        with:
#          persist-credentials: false #checkoutä¾èµ–å‚æ•°ï¼šä¸ä¿å­˜è¯ä¹¦
#      - name: install and build #æ­¥éª¤2ï¼šå®‰è£…ä¾èµ–å’Œæ‰“åŒ…
#        run: | #è¿è¡Œä¸‹é¢ä¸¤è¡Œå‘½ä»¤
#          npm install #å®‰è£…ä¾èµ–ï¼Œå½“å‰åˆ†æ”¯çš„æ ¹ç›®å½•åšä¸ºé»˜è®¤ç›®å½•
#          npm run build:prod #æ‰“åŒ…ä»£ç 
#
#      - name: Install SSH Client #æ­¥éª¤3ï¼šå…³è”sshç§é’¥
#        uses: webfactory/ssh-agent@v0.2.0 #è¿™é‡Œè°ƒç”¨è¿™ä¸ªç¬¬ä¸‰æ–¹çš„åº“ï¼Œå¯ä»¥ç›´æ¥å…³è”sshç§é’¥
#        with: #ä¸‹é¢æ˜¯å‚æ•°
#          #è¿™é‡Œéœ€è¦é€šè¿‡githubçš„ç¯å¢ƒå‚æ•°ä¸­è·å–ç§é’¥ï¼Œå¹¶ä¼ ç»™è¿™ä¸ªåº“ï¼Œï¼ˆè¿™æ˜¯æœ€å®‰å…¨çš„ï¼Œgitå½“ç„¶ä¸èƒ½è®©ç”¨æˆ·ç›´æ¥è¾“å…¥ç§é’¥å†…å®¹ï¼‰
#          ssh-private-key: ${{ secrets.TESTVUECICD }} 

#      - name: Deploy #æ­¥éª¤4ï¼šæŠŠç¼–è¯‘å¥½çš„é™æ€ç›®å½•ä¸Šä¼ åˆ°gh-pagesåˆ†æ”¯ä¸Š
#        uses: JamesIves/github-pages-deploy-action@3.5.9 #è¿™é‡Œè°ƒç”¨ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œç”¨äºä¸Šä¼ ä»£ç åˆ°æŒ‡å®šåˆ†æ”¯ä¸Š
#        with:
#          SSH: true #æ˜¯å¦é€šè¿‡sshæ–¹å¼
#          BRANCH: gh-pages #github pages é»˜è®¤çš„åˆ†æ”¯
#          FOLDER: dist #ä¸Šä¼ æ–‡ä»¶çš„ç›®å½•ï¼Œæˆ‘è¿™ä¸ªç›®å½•åœ¨æ ¹ç›®å½•ä¸‹ï¼Œå¦‚æœæ˜¯å­ç›®å½•å¯ä»¥è¿™ä¹ˆå†™  docs/.vuepress/dist



name: github pages

on:
  push:
    branches:
      - master

jobs:
  deploy:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2

      - name: Setup Node
        uses: actions/setup-node@v1
        with:
          node-version: '13.x'

      - name: Get yarn cache
        id: yarn-cache
        run: echo "::set-output name=dir::$(yarn cache dir)"

      - name: Cache dependencies
        uses: actions/cache@v1
        with:
          path: ${{ steps.yarn-cache.outputs.dir }}
          key: ${{ runner.os }}-yarn-${{ hashFiles('**/yarn.lock') }}
          restore-keys: |
            ${{ runner.os }}-yarn-
      - run: yarn install

      - run: yarn build

      - name: deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
          publish_dir: ./dist



name: "github actions build and deploy gh-pages" #æµç¨‹åç§°
on: [push] #å½“å¯¹å½“å‰ä»“åº“pushä»£ç çš„æ—¶å€™è§¦å‘
jobs: 
  build-and-deploy: #è„šæœ¬åç§°
    runs-on: ubuntu-latest #è¿è¡Œåœ¨ä¹Œç­å›¾linuxä¸Š
    steps:
      - name: Checkout  #æ­¥éª¤1ï¼šcheckout
        uses: actions/checkout@v2.3.1 #checkoutéœ€è¦å¼•ç”¨çš„ä¾èµ–
        with:
          persist-credentials: false #checkoutä¾èµ–å‚æ•°ï¼šä¸ä¿å­˜è¯ä¹¦
      - uses: .github/workflows
        env:
          GITHUB_TOKEN: ${{ secrets.TESTVUECICD }}
        id: action
      - name: Upload to this repo
        run: |
          git config --global user.name "SusieWu" # æ”¹æˆGithubè´¦å·ç”¨æˆ·å
          git config --global user.email "943299594@qq.com" # æ”¹æˆGitHubè´¦å·çš„é‚®ç®±
      - name: install and build #æ­¥éª¤2ï¼šå®‰è£…ä¾èµ–å’Œæ‰“åŒ…
        run: | #è¿è¡Œä¸‹é¢ä¸¤è¡Œå‘½ä»¤
          npm install #å®‰è£…ä¾èµ–ï¼Œå½“å‰åˆ†æ”¯çš„æ ¹ç›®å½•åšä¸ºé»˜è®¤ç›®å½•
          npm run build:prod #æ‰“åŒ…ä»£ç 
      - name: Deploy #æ­¥éª¤4ï¼šæŠŠç¼–è¯‘å¥½çš„é™æ€ç›®å½•ä¸Šä¼ åˆ°gh-pagesåˆ†æ”¯ä¸Š
        uses: JamesIves/github-pages-deploy-action@3.5.9 #è¿™é‡Œè°ƒç”¨ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œç”¨äºä¸Šä¼ ä»£ç åˆ°æŒ‡å®šåˆ†æ”¯ä¸Š
        with:
          BRANCH: master #github pages é»˜è®¤çš„åˆ†æ”¯
          FOLDER: dist #ä¸Šä¼ æ–‡ä»¶çš„ç›®å½•ï¼Œæˆ‘è¿™ä¸ªç›®å½•åœ¨æ ¹ç›®å½•ä¸‹ï¼Œå¦‚æœæ˜¯å­ç›®å½•å¯ä»¥è¿™ä¹ˆå†™  docs/.vuepress/dist